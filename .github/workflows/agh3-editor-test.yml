name: âš™ï¸ [AGH3-Editor] ðŸ§ª Test

on:
  pull_request:
    branches:
      - main
    paths:
      - charts/editor/**
      - .github/workflows/agh3-editor-release.yml

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ”” Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: âš™ï¸ Configure Git
        run: |
          git config user.name "$GITHUB_ACTOR"
          git config user.email "$GITHUB_ACTOR@users.noreply.github.com"

      - name: ðŸª Install Helm
        uses: azure/setup-helm@v4
        with:
          version: v3.14.4

      - name: ðŸ“¦ Add Helm dependency repos
        run: |
          helm repo add bitnami https://charts.bitnami.com/bitnami
          helm repo add lkclab https://charts.lkc-lab.com
          helm repo update

      - name: ðŸ§ª Run chart-linting
        run: |
          helm dependency build charts/editor
          helm lint --set agh3.enabled=false charts/editor

      - name: ðŸ§ª Run chart-testing -> internal mode (default)
        run: |
          helm dependency build charts/editor
          helm template agh charts/editor \
            --set agh3.enabled=false \
            --set customRegistrySecret.auth.username='robot$ci-test-lkc-lab+foo' \
            --set customRegistrySecret.auth.password='ci-test-9e1e8ee7-edba-49d9-9cae-2dabf522d4d1' \
            -n agh3-editor
